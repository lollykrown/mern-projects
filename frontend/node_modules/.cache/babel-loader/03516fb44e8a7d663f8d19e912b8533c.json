{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/sayconfirmproductionsltd/Documents/GitHub/mern-projects/frontend/src/pages/DetailedPost.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Link, useHistory, useParams } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport LikePost from \"../components/LikePost\";\nimport SavePost from \"../components/SavePost\";\nimport Comment from \"../components/Comment\";\nimport Placeholder from \"../components/Placeholder\";\nimport Avatar from \"../styles/Avatar\";\nimport Loader from \"../components/Loader\";\nimport Modal from \"../components/Modal\";\nimport { ModalContent } from \"../components/Post\";\nimport useInput from \"../hooks/useInput\";\nimport { timeSince } from \"../utils\";\nimport { MoreIcon, CommentIcon, InboxIcon } from \"../components/Icons\";\nimport { toast } from \"react-toastify\";\nimport Button from \"../styles/Button\";\nimport PlaceholderContainer from \"../styles/PlaceholderContainer\";\nimport axios from 'axios';\nimport Axios from '../utils/axios';\nconst Wrapper = styled.div`\n  display: grid;\n  grid-template-columns: 60% 1fr;\n\n  .post-info {\n    border: 1px solid ${props => props.theme.borderColor};\n  }\n\n  .post-header-wrapper {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 1rem;\n    border-bottom: 1px solid ${props => props.theme.borderColor};\n  }\n\n  .post-header {\n    display: flex;\n    align-items: center;\n  }\n\n  .post-img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n\n  .post-actions-stats {\n    padding: 1rem;\n    padding-bottom: 0.1rem;\n  }\n\n  .post-actions {\n    display: flex;\n    align-items: center;\n    padding-bottom: 0.5rem;\n  }\n\n  .post-actions svg:last-child {\n    margin-left: auto;\n  }\n\n  .comments {\n    border-bottom: 1px solid ${props => props.theme.borderColor};\n    padding: 1rem;\n    height: 300px;\n    overflow-y: scroll;\n    scrollbar-width: none;\n  }\n\n  .comments::-webkit-scrollbar {\n    width: 0;\n    height: 0;\n  }\n\n  svg {\n    margin-right: 1rem;\n  }\n\n  textarea {\n    height: 100%;\n    width: 100%;\n    background: ${props => props.theme.bg};\n    border: none;\n    border-top: 1px solid ${props => props.theme.borderColor};\n    resize: none;\n    padding: 1rem 0 0 1rem;\n    font-size: 1rem;\n    font-family: \"Fira Sans\", sans-serif;\n  }\n\n  @media screen and (max-width: 840px) {\n    display: flex;\n    flex-direction: column;\n\n    .comments {\n      height: 100%;\n    }\n  }\n`;\n_c = Wrapper;\n\nconst DetailedPost = () => {\n  _s();\n\n  var _post$files, _post$user2, _post$user4;\n\n  const CancelToken = axios.CancelToken;\n  const source = CancelToken.source();\n  const history = useHistory();\n  const {\n    postId\n  } = useParams();\n  const comment = useInput(\"\");\n  const commmentsEndRef = useRef(null);\n  const [showModal, setShowModal] = useState(false);\n\n  const closeModal = () => setShowModal(false);\n\n  const [loading, setLoading] = useState(true);\n  const [deadend, setDeadend] = useState(false);\n  const [post, setPost] = useState({});\n  const [likesState, setLikes] = useState(0);\n  const [commentsState, setComments] = useState([]);\n\n  const incLikes = () => setLikes(likesState + 1);\n\n  const decLikes = () => setLikes(likesState - 1);\n\n  const scrollToBottom = () => commmentsEndRef.current.scrollIntoView({\n    behaviour: \"smooth\"\n  });\n\n  const handleRequest = async id => {\n    try {\n      const res = await Axios.post(`/posts/${id}/comments`, {\n        text: comment.value\n      }, {\n        cancelToken: source.token\n      });\n      setComments([...commentsState, res.data.data]);\n      scrollToBottom();\n    } catch (err) {\n      if (axios.isCancel(err)) {\n        console.log('Get request canceled');\n        toast.error(err.message);\n      } else {\n        console.log(err);\n        toast.error(err.message);\n      }\n    }\n\n    return () => {\n      source.cancel('Operation canceled by the user.');\n    };\n  };\n\n  const handleAddComment = e => {\n    if (e.keyCode === 13) {\n      e.preventDefault();\n      handleRequest(post._id);\n      comment.setValue(\"\");\n    }\n  };\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n\n    const handleRequest = async id => {\n      try {\n        const res = await Axios.get(`/posts/${id}`, {\n          cancelToken: source.token\n        });\n        setPost(res.data.data);\n        setComments(res.data.data.comments);\n        setLikes(res.data.data.likesCount);\n        setLoading(false);\n        setDeadend(false);\n      } catch (err) {\n        if (axios.isCancel(err)) {\n          console.log('Get request canceled');\n          toast.error(err.message);\n        } else {\n          setDeadend(true);\n          console.log(err);\n          toast.error(err.message);\n        }\n      }\n    };\n\n    handleRequest(postId);\n    return () => {\n      source.cancel('Operation canceled by the user.');\n    };\n  }, [postId]);\n\n  if (!deadend && loading) {\n    return /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 12\n    }, this);\n  }\n\n  if (deadend) {\n    return /*#__PURE__*/_jsxDEV(PlaceholderContainer, {\n      children: [/*#__PURE__*/_jsxDEV(Placeholder, {\n        title: \"Sorry, this page isn't available\",\n        text: \"The link you followed may be broken, or the page may have been removed\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/\",\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          children: \"Home\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 22\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: [/*#__PURE__*/_jsxDEV(\"img\", {\n      className: \"post-img\",\n      src: ((_post$files = post.files) === null || _post$files === void 0 ? void 0 : _post$files.length) && post.files[0],\n      alt: \"post\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"post-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"post-header-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"post-header\",\n          children: [/*#__PURE__*/_jsxDEV(Avatar, {\n            onClick: () => {\n              var _post$user;\n\n              return history.push(`/${(_post$user = post.user) === null || _post$user === void 0 ? void 0 : _post$user.username}`);\n            },\n            className: \"pointer avatar\",\n            src: (_post$user2 = post.user) === null || _post$user2 === void 0 ? void 0 : _post$user2.avatar,\n            alt: \"avatar\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"pointer\",\n            onClick: () => {\n              var _post$user3;\n\n              return history.push(`/${(_post$user3 = post.user) === null || _post$user3 === void 0 ? void 0 : _post$user3.username}`);\n            },\n            children: (_post$user4 = post.user) === null || _post$user4 === void 0 ? void 0 : _post$user4.username\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }, this), post.isMine && /*#__PURE__*/_jsxDEV(MoreIcon, {\n          onClick: () => setShowModal(true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 27\n        }, this), showModal && /*#__PURE__*/_jsxDEV(Modal, {\n          children: /*#__PURE__*/_jsxDEV(ModalContent, {\n            postId: post._id,\n            hideGotoPost: true,\n            closeModal: closeModal\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"comments\",\n        children: [commentsState.map(comment => /*#__PURE__*/_jsxDEV(Comment, {\n          comment: comment\n        }, comment._id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: commmentsEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"post-actions-stats\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"post-actions\",\n          children: [/*#__PURE__*/_jsxDEV(LikePost, {\n            isLiked: post === null || post === void 0 ? void 0 : post.isLiked,\n            postId: post === null || post === void 0 ? void 0 : post._id,\n            incLikes: incLikes,\n            decLikes: decLikes\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 253,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(CommentIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(InboxIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(SavePost, {\n            isSaved: post === null || post === void 0 ? void 0 : post.isSaved,\n            postId: post === null || post === void 0 ? void 0 : post._id\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 11\n        }, this), likesState !== 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"likes bold\",\n          children: [likesState, \" \", likesState > 1 ? \"likes\" : \"like\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          display: \"block\",\n          padding: \"0 1rem\",\n          paddingBottom: \"1rem\"\n        },\n        className: \"secondary\",\n        children: [timeSince(post.createdAt), \" ago\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"add-comment\",\n        children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n          columns: \"2\",\n          placeholder: \"Add a Comment\",\n          value: comment.value,\n          onChange: comment.onChange,\n          onKeyDown: handleAddComment\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 207,\n    columnNumber: 5\n  }, this);\n};\n\n_s(DetailedPost, \"UzeefLsh2YT8kRsJoZcijbTKLr8=\", false, function () {\n  return [useHistory, useParams, useInput];\n});\n\n_c2 = DetailedPost;\nexport default DetailedPost;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Wrapper\");\n$RefreshReg$(_c2, \"DetailedPost\");","map":{"version":3,"sources":["/Users/sayconfirmproductionsltd/Documents/GitHub/mern-projects/frontend/src/pages/DetailedPost.js"],"names":["React","useState","useEffect","useRef","Link","useHistory","useParams","styled","LikePost","SavePost","Comment","Placeholder","Avatar","Loader","Modal","ModalContent","useInput","timeSince","MoreIcon","CommentIcon","InboxIcon","toast","Button","PlaceholderContainer","axios","Axios","Wrapper","div","props","theme","borderColor","bg","DetailedPost","CancelToken","source","history","postId","comment","commmentsEndRef","showModal","setShowModal","closeModal","loading","setLoading","deadend","setDeadend","post","setPost","likesState","setLikes","commentsState","setComments","incLikes","decLikes","scrollToBottom","current","scrollIntoView","behaviour","handleRequest","id","res","text","value","cancelToken","token","data","err","isCancel","console","log","error","message","cancel","handleAddComment","e","keyCode","preventDefault","_id","setValue","window","scrollTo","get","comments","likesCount","files","length","push","user","username","avatar","isMine","map","isLiked","isSaved","display","padding","paddingBottom","createdAt","onChange"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { Link, useHistory, useParams } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport LikePost from \"../components/LikePost\";\nimport SavePost from \"../components/SavePost\";\nimport Comment from \"../components/Comment\";\nimport Placeholder from \"../components/Placeholder\";\nimport Avatar from \"../styles/Avatar\";\nimport Loader from \"../components/Loader\";\nimport Modal from \"../components/Modal\";\nimport { ModalContent } from \"../components/Post\";\nimport useInput from \"../hooks/useInput\";\nimport { timeSince } from \"../utils\";\nimport { MoreIcon, CommentIcon, InboxIcon } from \"../components/Icons\";\nimport { toast } from \"react-toastify\";\nimport Button from \"../styles/Button\";\nimport PlaceholderContainer from \"../styles/PlaceholderContainer\";\nimport axios from 'axios';\nimport Axios from '../utils/axios'\n\nconst Wrapper = styled.div`\n  display: grid;\n  grid-template-columns: 60% 1fr;\n\n  .post-info {\n    border: 1px solid ${(props) => props.theme.borderColor};\n  }\n\n  .post-header-wrapper {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 1rem;\n    border-bottom: 1px solid ${(props) => props.theme.borderColor};\n  }\n\n  .post-header {\n    display: flex;\n    align-items: center;\n  }\n\n  .post-img {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n\n  .post-actions-stats {\n    padding: 1rem;\n    padding-bottom: 0.1rem;\n  }\n\n  .post-actions {\n    display: flex;\n    align-items: center;\n    padding-bottom: 0.5rem;\n  }\n\n  .post-actions svg:last-child {\n    margin-left: auto;\n  }\n\n  .comments {\n    border-bottom: 1px solid ${(props) => props.theme.borderColor};\n    padding: 1rem;\n    height: 300px;\n    overflow-y: scroll;\n    scrollbar-width: none;\n  }\n\n  .comments::-webkit-scrollbar {\n    width: 0;\n    height: 0;\n  }\n\n  svg {\n    margin-right: 1rem;\n  }\n\n  textarea {\n    height: 100%;\n    width: 100%;\n    background: ${(props) => props.theme.bg};\n    border: none;\n    border-top: 1px solid ${(props) => props.theme.borderColor};\n    resize: none;\n    padding: 1rem 0 0 1rem;\n    font-size: 1rem;\n    font-family: \"Fira Sans\", sans-serif;\n  }\n\n  @media screen and (max-width: 840px) {\n    display: flex;\n    flex-direction: column;\n\n    .comments {\n      height: 100%;\n    }\n  }\n`;\n\nconst DetailedPost = () => {\n  const CancelToken = axios.CancelToken;\n  const source = CancelToken.source();\n\n  const history = useHistory();\n  const { postId } = useParams();\n\n  const comment = useInput(\"\");\n  const commmentsEndRef = useRef(null);\n\n  const [showModal, setShowModal] = useState(false);\n  const closeModal = () => setShowModal(false);\n\n  const [loading, setLoading] = useState(true);\n  const [deadend, setDeadend] = useState(false);\n  const [post, setPost] = useState({});\n\n  const [likesState, setLikes] = useState(0);\n  const [commentsState, setComments] = useState([]);\n\n  const incLikes = () => setLikes(likesState + 1);\n  const decLikes = () => setLikes(likesState - 1);\n\n  const scrollToBottom = () =>\n    commmentsEndRef.current.scrollIntoView({ behaviour: \"smooth\" });\n\n  const handleRequest = async (id) => {\n    try {\n      const res = await Axios.post(`/posts/${id}/comments`, { text: comment.value }, {\n        cancelToken: source.token\n      })\n      setComments([...commentsState, res.data.data]);\n      scrollToBottom();\n\n    } catch (err) {\n      if (axios.isCancel(err)) {\n        console.log('Get request canceled');\n        toast.error(err.message)\n      } else {\n        console.log(err)\n        toast.error(err.message)\n      }\n    }\n    return () => {\n      source.cancel('Operation canceled by the user.');\n    };\n  };\n\n  const handleAddComment = (e) => {\n    if (e.keyCode === 13) {\n      e.preventDefault();\n\n      handleRequest(post._id)\n\n      comment.setValue(\"\");\n    }\n  };\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n    const handleRequest = async (id) => {\n      try {\n        const res = await Axios.get(`/posts/${id}`, {\n          cancelToken: source.token\n        })\n        setPost(res.data.data);\n        setComments(res.data.data.comments);\n        setLikes(res.data.data.likesCount);\n        setLoading(false);\n        setDeadend(false);\n\n      } catch (err) {\n        if (axios.isCancel(err)) {\n          console.log('Get request canceled');\n          toast.error(err.message)\n        } else {\n          setDeadend(true)\n          console.log(err)\n          toast.error(err.message)\n        }\n      }\n    };\n    handleRequest(postId)\n    return () => {\n      source.cancel('Operation canceled by the user.');\n    };\n  }, [postId]);\n\n  if (!deadend && loading) {\n    return <Loader />;\n  }\n\n  if (deadend) {\n    return (\n      <PlaceholderContainer>\n        <Placeholder\n          title=\"Sorry, this page isn't available\"\n          text=\"The link you followed may be broken, or the page may have been removed\"\n        />\n        <Link to=\"/\"><Button>Home</Button></Link>\n      </PlaceholderContainer>\n    );\n  }\n\n  return (\n    <Wrapper>\n      <img\n        className=\"post-img\"\n        src={post.files?.length && post.files[0]}\n        alt=\"post\"\n      />\n\n      <div className=\"post-info\">\n        <div className=\"post-header-wrapper\">\n          <div className=\"post-header\">\n            <Avatar\n              onClick={() => history.push(`/${post.user?.username}`)}\n              className=\"pointer avatar\"\n              src={post.user?.avatar}\n              alt=\"avatar\"\n            />\n\n            <h3\n              className=\"pointer\"\n              onClick={() => history.push(`/${post.user?.username}`)}\n            >\n              {post.user?.username}\n            </h3>\n          </div>\n          {post.isMine && <MoreIcon onClick={() => setShowModal(true)} />}\n\n          {showModal && (\n            <Modal>\n              <ModalContent\n                postId={post._id}\n                hideGotoPost={true}\n                closeModal={closeModal}\n              />\n            </Modal>\n          )}\n        </div>\n\n        <div className=\"comments\">\n          {commentsState.map((comment) => (\n            <Comment key={comment._id} comment={comment} />\n          ))}\n          <div ref={commmentsEndRef} />\n        </div>\n\n        <div className=\"post-actions-stats\">\n          <div className=\"post-actions\">\n            <LikePost\n              isLiked={post?.isLiked}\n              postId={post?._id}\n              incLikes={incLikes}\n              decLikes={decLikes}\n            />\n            <CommentIcon />\n            <InboxIcon />\n            <SavePost isSaved={post?.isSaved} postId={post?._id} />\n          </div>\n\n          {likesState !== 0 && (\n            <span className=\"likes bold\">\n              {likesState} {likesState > 1 ? \"likes\" : \"like\"}\n            </span>\n          )}\n        </div>\n\n        <span\n          style={{ display: \"block\", padding: \"0 1rem\", paddingBottom: \"1rem\" }}\n          className=\"secondary\"\n        >\n          {timeSince(post.createdAt)} ago\n        </span>\n\n        <div className=\"add-comment\">\n          <textarea\n            columns=\"2\"\n            placeholder=\"Add a Comment\"\n            value={comment.value}\n            onChange={comment.onChange}\n            onKeyDown={handleAddComment}\n          ></textarea>\n        </div>\n      </div>\n    </Wrapper>\n  );\n};\n\nexport default DetailedPost;\n"]},"metadata":{},"sourceType":"module"}