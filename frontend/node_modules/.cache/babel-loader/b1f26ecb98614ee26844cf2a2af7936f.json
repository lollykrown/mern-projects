{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/sayconfirmproductionsltd/Documents/GitHub/mern-projects/frontend/src/components/Post.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useContext, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useHistory } from \"react-router-dom\";\nimport LikePost from \"./LikePost\";\nimport SavePost from \"./SavePost\";\nimport Comment from \"./Comment\";\nimport DeletePost from \"./DeletePost\";\nimport Modal from \"./Modal\";\nimport useInput from \"../hooks/useInput\";\nimport Avatar from \"../styles/Avatar\";\nimport { timeSince } from \"../utils\";\nimport { MoreIcon, CommentIcon, InboxIcon } from \"./Icons\";\nimport { toast } from \"react-toastify\";\nimport ModalContentWrapper from '../styles/ModalContentWrapper';\nimport axios from 'axios';\nimport Axios from '../utils/axios';\nimport { UserContext } from \"../context/UserContext\";\nexport const ModalContent = ({\n  hideGotoPost,\n  postId,\n  closeModal\n}) => {\n  _s();\n\n  const history = useHistory();\n\n  const handleGoToPost = () => {\n    closeModal();\n    history.push(`/p/${postId}`);\n  };\n\n  return /*#__PURE__*/_jsxDEV(ModalContentWrapper, {\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"danger\",\n      onClick: closeModal,\n      children: \"Cancel\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 29,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DeletePost, {\n      postId: postId,\n      closeModal: closeModal,\n      goToHome: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 7\n    }, this), !hideGotoPost && /*#__PURE__*/_jsxDEV(\"span\", {\n      onClick: handleGoToPost,\n      children: \"Go to Post\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 33,\n      columnNumber: 25\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 28,\n    columnNumber: 5\n  }, this);\n};\n\n_s(ModalContent, \"9cZfZ04734qoCGIctmKX7+sX6eU=\", false, function () {\n  return [useHistory];\n});\n\n_c = ModalContent;\nexport const PostWrapper = styled.div`\n  width: 615px;\n  background: ${props => props.theme.white};\n  border: 1px solid ${props => props.theme.borderColor};\n  margin-bottom: 1.5rem;\n\tcursor: pointer;\n\n  .post-header-wrapper {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n\n  .post-header {\n    display: flex;\n    align-items: center;\n    padding: 1rem;\n  }\n\n  .post-header h3 {\n    cursor: pointer;\n  }\n\n  .post-img {\n    width: 100%;\n    height: 100%;\n  }\n\n  .post-actions {\n    display: flex;\n    align-items: center;\n    padding: 0.5rem 1rem;\n    padding-bottom: 0.2rem;\n  }\n\n  .post-actions svg:last-child {\n    margin-left: auto;\n  }\n\n  svg {\n    margin-right: 1rem;\n  }\n\n  .likes-caption-comments {\n    padding: 1rem;\n    padding-top: 0.3rem;\n  }\n\n  .username {\n    padding-right: 0.3rem;\n  }\n\n  .view-comments {\n    color: ${props => props.theme.secondaryColor};\n    cursor: pointer;\n  }\n\n  textarea {\n    height: 100%;\n    width: 100%;\n    border: none;\n    border-top: 1px solid ${props => props.theme.borderColor};\n    resize: none;\n    padding: 1rem 0 0 1rem;\n    font-size: 1rem;\n    font-family: \"Fira Sans\", sans-serif;\n  }\n\n  @media screen and (max-width: 690px) {\n    width: 99%;\n  }\n`;\n_c2 = PostWrapper;\n\nconst Post = ({\n  post\n}) => {\n  _s2();\n\n  var _post$user, _post$user4, _post$files, _post$user6;\n\n  const {\n    user\n  } = useContext(UserContext); // has the loggedin user liked the post??\n\n  const likes = post.likes.map(like => like.toString());\n  post.isLiked = likes.includes(user._id);\n  const comment = useInput(\"\");\n  const history = useHistory();\n  const [showModal, setShowModal] = useState(false);\n\n  const closeModal = () => setShowModal(false);\n\n  const [newComments, setNewComments] = useState([]);\n  const [likesState, setLikes] = useState(post.likesCount);\n\n  const incLikes = () => setLikes(likesState + 1);\n\n  const decLikes = () => setLikes(likesState - 1);\n\n  const CancelToken = axios.CancelToken;\n  const source = CancelToken.source();\n\n  const handleRequest = async (newc, id) => {\n    try {\n      const res = await Axios.post(`/posts/${id}/comments`, {\n        text: comment.value\n      }, {\n        cancelToken: source.token\n      });\n      console.log('comments', res.data);\n      setNewComments([...newc, res.data.data]);\n    } catch (err) {\n      if (axios.isCancel(err)) {\n        console.log('Get request canceled');\n        toast.error(err.message);\n      } else {\n        console.log(err);\n        toast.error(err.message);\n      }\n    }\n\n    return () => {\n      source.cancel('Operation canceled by the user.');\n    };\n  };\n\n  const handleAddComment = e => {\n    if (e.keyCode === 13) {\n      e.preventDefault();\n      handleRequest(newComments, post._id);\n      comment.setValue(\"\");\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(PostWrapper, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"post-header-wrapper\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"post-header\",\n        children: [/*#__PURE__*/_jsxDEV(Avatar, {\n          className: \"pointer\",\n          src: (_post$user = post.user) === null || _post$user === void 0 ? void 0 : _post$user.avatar,\n          alt: \"avatar\",\n          onClick: () => {\n            var _post$user2;\n\n            return history.push(`/${(_post$user2 = post.user) === null || _post$user2 === void 0 ? void 0 : _post$user2.username}`);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"pointer\",\n          onClick: () => {\n            var _post$user3;\n\n            return history.push(`/${(_post$user3 = post.user) === null || _post$user3 === void 0 ? void 0 : _post$user3.username}`);\n          },\n          children: (_post$user4 = post.user) === null || _post$user4 === void 0 ? void 0 : _post$user4.username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }, this), showModal && /*#__PURE__*/_jsxDEV(Modal, {\n        children: /*#__PURE__*/_jsxDEV(ModalContent, {\n          postId: post._id,\n          closeModal: closeModal\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 11\n      }, this), post.isMine && /*#__PURE__*/_jsxDEV(MoreIcon, {\n        onClick: () => setShowModal(true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 25\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n      // onClick={() => history.push(`/p/${post._id}`)}\n      className: \"post-img\",\n      src: ((_post$files = post.files) === null || _post$files === void 0 ? void 0 : _post$files.length) && post.files[0],\n      alt: \"post-img\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"post-actions\",\n      children: [/*#__PURE__*/_jsxDEV(LikePost, {\n        isLiked: post === null || post === void 0 ? void 0 : post.isLiked,\n        postId: post._id,\n        incLikes: incLikes,\n        decLikes: decLikes\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(CommentIcon, {\n        onClick: () => history.push(`/p/${post._id}`)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(InboxIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SavePost, {\n        isSaved: post.isSaved,\n        postId: post._id\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"likes-caption-comments\",\n      children: [likesState !== 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"likes bold\",\n        children: [likesState, \" \", likesState > 1 ? \"likes\" : \"like\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 11\n      }, this), post && /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          onClick: () => {\n            var _post$user5;\n\n            return history.push(`/${(_post$user5 = post.user) === null || _post$user5 === void 0 ? void 0 : _post$user5.username}`);\n          },\n          className: \"pointer username bold\",\n          children: (_post$user6 = post.user) === null || _post$user6 === void 0 ? void 0 : _post$user6.username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 11\n        }, this), post.caption]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 18\n      }, this), post.commentsCount > 2 && /*#__PURE__*/_jsxDEV(\"span\", {\n        onClick: () => history.push(`/p/${post._id}`),\n        className: \"view-comments\",\n        children: [\"View all \", post.commentsCount, \" comments\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 11\n      }, this), post.comments.length > 0 && post.comments.slice(0, 2).map(c => /*#__PURE__*/_jsxDEV(Comment, {\n        hideavatar: true,\n        comment: c\n      }, c._id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 11\n      }, this)), newComments && newComments.map(c => /*#__PURE__*/_jsxDEV(Comment, {\n        hideavatar: true,\n        comment: c\n      }, c._id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 11\n      }, this)), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"secondary\",\n        children: [timeSince(post === null || post === void 0 ? void 0 : post.createdAt), \" ago\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"add-comment\",\n      children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n        columns: \"3\",\n        placeholder: \"Add a Comment\",\n        value: comment.value,\n        onChange: comment.onChange,\n        onKeyDown: handleAddComment\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 163,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(Post, \"3omFMKImN3j4O1M5WqSW74E2FPk=\", false, function () {\n  return [useInput, useHistory];\n});\n\n_c3 = Post;\nexport default Post;\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"ModalContent\");\n$RefreshReg$(_c2, \"PostWrapper\");\n$RefreshReg$(_c3, \"Post\");","map":{"version":3,"sources":["/Users/sayconfirmproductionsltd/Documents/GitHub/mern-projects/frontend/src/components/Post.js"],"names":["React","useContext","useState","styled","useHistory","LikePost","SavePost","Comment","DeletePost","Modal","useInput","Avatar","timeSince","MoreIcon","CommentIcon","InboxIcon","toast","ModalContentWrapper","axios","Axios","UserContext","ModalContent","hideGotoPost","postId","closeModal","history","handleGoToPost","push","PostWrapper","div","props","theme","white","borderColor","secondaryColor","Post","post","user","likes","map","like","toString","isLiked","includes","_id","comment","showModal","setShowModal","newComments","setNewComments","likesState","setLikes","likesCount","incLikes","decLikes","CancelToken","source","handleRequest","newc","id","res","text","value","cancelToken","token","console","log","data","err","isCancel","error","message","cancel","handleAddComment","e","keyCode","preventDefault","setValue","avatar","username","isMine","files","length","isSaved","caption","commentsCount","comments","slice","c","createdAt","onChange"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { useHistory } from \"react-router-dom\";\nimport LikePost from \"./LikePost\";\nimport SavePost from \"./SavePost\";\nimport Comment from \"./Comment\";\nimport DeletePost from \"./DeletePost\";\nimport Modal from \"./Modal\";\nimport useInput from \"../hooks/useInput\";\nimport Avatar from \"../styles/Avatar\";\nimport { timeSince } from \"../utils\";\nimport { MoreIcon, CommentIcon, InboxIcon } from \"./Icons\";\nimport { toast } from \"react-toastify\";\nimport ModalContentWrapper from '../styles/ModalContentWrapper'\nimport axios from 'axios';\nimport Axios from '../utils/axios'\nimport { UserContext } from \"../context/UserContext\";\n\nexport const ModalContent = ({ hideGotoPost, postId, closeModal }) => {\n  const history = useHistory();\n\n  const handleGoToPost = () => {\n    closeModal();\n    history.push(`/p/${postId}`);\n  };\n\n  return (\n    <ModalContentWrapper>\n      <span className=\"danger\" onClick={closeModal}>\n        Cancel\n      </span>\n      <DeletePost postId={postId} closeModal={closeModal} goToHome={true} />\n      {!hideGotoPost && <span onClick={handleGoToPost}>Go to Post</span>}\n    </ModalContentWrapper>\n  );\n};\n\nexport const PostWrapper = styled.div`\n  width: 615px;\n  background: ${(props) => props.theme.white};\n  border: 1px solid ${(props) => props.theme.borderColor};\n  margin-bottom: 1.5rem;\n\tcursor: pointer;\n\n  .post-header-wrapper {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n\n  .post-header {\n    display: flex;\n    align-items: center;\n    padding: 1rem;\n  }\n\n  .post-header h3 {\n    cursor: pointer;\n  }\n\n  .post-img {\n    width: 100%;\n    height: 100%;\n  }\n\n  .post-actions {\n    display: flex;\n    align-items: center;\n    padding: 0.5rem 1rem;\n    padding-bottom: 0.2rem;\n  }\n\n  .post-actions svg:last-child {\n    margin-left: auto;\n  }\n\n  svg {\n    margin-right: 1rem;\n  }\n\n  .likes-caption-comments {\n    padding: 1rem;\n    padding-top: 0.3rem;\n  }\n\n  .username {\n    padding-right: 0.3rem;\n  }\n\n  .view-comments {\n    color: ${(props) => props.theme.secondaryColor};\n    cursor: pointer;\n  }\n\n  textarea {\n    height: 100%;\n    width: 100%;\n    border: none;\n    border-top: 1px solid ${(props) => props.theme.borderColor};\n    resize: none;\n    padding: 1rem 0 0 1rem;\n    font-size: 1rem;\n    font-family: \"Fira Sans\", sans-serif;\n  }\n\n  @media screen and (max-width: 690px) {\n    width: 99%;\n  }\n`;\n\nconst Post = ({ post }) => {\n  const { user } = useContext(UserContext);\n\n  // has the loggedin user liked the post??\n  const likes = post.likes.map((like) => like.toString());\n  post.isLiked = likes.includes(user._id);\n\n  const comment = useInput(\"\");\n  const history = useHistory();\n\n  const [showModal, setShowModal] = useState(false);\n  const closeModal = () => setShowModal(false);\n\n  const [newComments, setNewComments] = useState([]);\n  const [likesState, setLikes] = useState(post.likesCount);\n\n  const incLikes = () => setLikes(likesState + 1);\n  const decLikes = () => setLikes(likesState - 1);\n  const CancelToken = axios.CancelToken;\n  const source = CancelToken.source();\n\n  const handleRequest = async (newc, id) => {\n    try {\n      const res = await Axios.post(`/posts/${id}/comments`, { text: comment.value }, {\n        cancelToken: source.token\n      })\n      console.log('comments', res.data)\n      setNewComments([...newc, res.data.data]);\n\n    } catch (err) {\n      if (axios.isCancel(err)) {\n        console.log('Get request canceled');\n        toast.error(err.message)\n      } else {\n        console.log(err)\n        toast.error(err.message)\n      }\n    }\n    return () => {\n      source.cancel('Operation canceled by the user.');\n    };\n  };\n\n  const handleAddComment = (e) => {\n    if (e.keyCode === 13) {\n      e.preventDefault();\n      handleRequest(newComments, post._id)\n      comment.setValue(\"\");\n    }\n  };\n\n  return (\n    <PostWrapper>\n      <div className=\"post-header-wrapper\">\n        <div className=\"post-header\">\n          <Avatar\n            className=\"pointer\"\n            src={post.user?.avatar}\n            alt=\"avatar\"\n            onClick={() => history.push(`/${post.user?.username}`)}\n          />\n          <h3\n            className=\"pointer\"\n            onClick={() => history.push(`/${post.user?.username}`)}\n          >\n            {post.user?.username}\n          </h3>\n        </div>\n\n        {showModal && (\n          <Modal>\n            <ModalContent postId={post._id} closeModal={closeModal} />\n          </Modal>\n        )}\n        {post.isMine && <MoreIcon onClick={() => setShowModal(true)} />}\n      </div>\n\n      <img\n        // onClick={() => history.push(`/p/${post._id}`)}\n        className=\"post-img\"\n        src={post.files?.length && post.files[0]}\n        alt=\"post-img\"\n      />\n\n      <div className=\"post-actions\">\n        <LikePost\n          isLiked={post?.isLiked}\n          postId={post._id}\n          incLikes={incLikes}\n          decLikes={decLikes}\n        />\n        <CommentIcon onClick={() => history.push(`/p/${post._id}`)} />\n        <InboxIcon />\n        <SavePost isSaved={post.isSaved} postId={post._id} />\n      </div>\n\n      <div className=\"likes-caption-comments\">\n        {likesState !== 0 && (\n          <span className=\"likes bold\">\n            {likesState} {likesState > 1 ? \"likes\" : \"like\"}\n          </span>\n        )}\n\n        {post && <p>\n          <span\n            onClick={() => history.push(`/${post.user?.username}`)}\n            className=\"pointer username bold\"\n          >\n            {post.user?.username}\n          </span>\n          {post.caption}\n        </p>}\n\n        {post.commentsCount > 2 && (\n          <span\n            onClick={() => history.push(`/p/${post._id}`)}\n            className=\"view-comments\"\n          >\n            View all {post.commentsCount} comments\n          </span>\n        )}\n\n        {post.comments.length > 0 && post.comments.slice(0, 2).map((c) => (\n          <Comment key={c._id} hideavatar={true} comment={c} />\n        ))}\n\n        {newComments && newComments.map((c) => (\n          <Comment key={c._id} hideavatar={true} comment={c} />\n        ))}\n\n        <span className=\"secondary\">{timeSince(post?.createdAt)} ago</span>\n      </div>\n\n      <div className=\"add-comment\">\n        <textarea\n          columns=\"3\"\n          placeholder=\"Add a Comment\"\n          value={comment.value}\n          onChange={comment.onChange}\n          onKeyDown={handleAddComment}\n        ></textarea>\n      </div>\n    </PostWrapper>\n  );\n};\n\nexport default Post;\n"]},"metadata":{},"sourceType":"module"}