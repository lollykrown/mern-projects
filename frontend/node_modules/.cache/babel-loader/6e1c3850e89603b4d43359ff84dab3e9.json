{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/Users/sayconfirmproductionsltd/Documents/GitHub/mern-projects/frontend/src/components/NewPost.js\",\n    _s = $RefreshSig$();\n\nimport React, { useContext, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { toast } from \"react-toastify\";\nimport Modal from \"./Modal\";\nimport useInput from \"../hooks/useInput\";\nimport { FeedContext } from \"../context/FeedContext\";\nimport { uploadImage } from \"../utils\";\nimport { NewPostIcon } from \"./Icons\";\nimport axios from 'axios';\nimport Axios from '../utils/axios';\nconst NewPostWrapper = styled.div`\n  .newpost-header {\n    display: flex;\n    justify-content: space-between;\n    padding: 0.5rem 1rem;\n  }\n\n  .newpost-header h3:first-child {\n    color: ${props => props.theme.red};\n  }\n\n  h3 {\n    cursor: pointer;\n  }\n\n  .newpost-header h3:last-child {\n    color: ${props => props.theme.blue};\n  }\n\n  textarea {\n    height: 100%;\n    width: 100%;\n    font-family: \"Fira Sans\", sans-serif;\n    font-size: 1rem;\n    padding: 0.5rem 1rem;\n    border: none;\n    resize: none;\n  }\n\n  .modal-content {\n    width: 700px;\n  }\n\n  @media screen and (max-width: 780px) {\n    .modal-content {\n      width: 90vw;\n    }\n  }\n`;\n_c = NewPostWrapper;\n\nconst NewPost = () => {\n  _s();\n\n  const {\n    feed,\n    setFeed\n  } = useContext(FeedContext);\n  const [showModal, setShowModal] = useState(false);\n  const caption = useInput(\"\");\n  const [preview, setPreview] = useState(\"\");\n  const [postImage, setPostImage] = useState(\"\");\n  const CancelToken = axios.CancelToken;\n  const source = CancelToken.source();\n\n  const handleUploadImage = e => {\n    if (e.target.files[0]) {\n      const reader = new FileReader();\n\n      reader.onload = e => {\n        setPreview(e.target.result);\n        setShowModal(true);\n      };\n\n      reader.readAsDataURL(e.target.files[0]);\n      uploadImage(e.target.files[0]).then(res => {\n        console.log('cloudinary', res);\n        setPostImage(res.data.secure_url);\n      });\n    }\n  };\n\n  const handleSubmitPost = async () => {\n    if (!caption.value) {\n      return toast.error(\"Please write a caption\");\n    }\n\n    setShowModal(false);\n    const tags = caption.value.split(\" \").filter(caption => caption.startsWith(\"#\"));\n    const cleanedCaption = caption.value.split(\" \").filter(caption => !caption.startsWith(\"#\")).join(\" \");\n    caption.setValue(\"\");\n    const body = {\n      caption: cleanedCaption,\n      files: [postImage],\n      tags\n    };\n\n    try {\n      const res = await Axios.post('/posts', body, {\n        cancelToken: source.token\n      });\n      console.log(res);\n      const post = res.data.data;\n      post.isLiked = false;\n      post.isSaved = false;\n      post.isMine = true;\n      setFeed([post, ...feed]);\n      window.scrollTo(0, 0);\n      toast.success(\"Your post has been submitted successfully\");\n    } catch (err) {\n      if (axios.isCancel(err)) {\n        console.log('Get request canceled');\n        toast.error(err.message);\n      } else {\n        console.log(err);\n        toast.error(err.message);\n      }\n    }\n\n    return () => {\n      source.cancel('Operation canceled by the user.');\n    };\n  };\n\n  return /*#__PURE__*/_jsxDEV(NewPostWrapper, {\n    children: [/*#__PURE__*/_jsxDEV(\"label\", {\n      htmlFor: \"upload-post\",\n      children: /*#__PURE__*/_jsxDEV(NewPostIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      id: \"upload-post\",\n      type: \"file\",\n      onChange: handleUploadImage,\n      accept: \"image/*\",\n      style: {\n        display: \"none\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 7\n    }, this), showModal && /*#__PURE__*/_jsxDEV(Modal, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"modal-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"newpost-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            onClick: () => setShowModal(false),\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            onClick: handleSubmitPost,\n            children: \"Share\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 13\n        }, this), preview && /*#__PURE__*/_jsxDEV(\"img\", {\n          className: \"post-preview\",\n          src: preview,\n          alt: \"preview\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n            placeholder: \"Add caption\",\n            value: caption.value,\n            onChange: caption.onChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 5\n  }, this);\n};\n\n_s(NewPost, \"2lnBnj69+Hs13cPvNm6X75yu9Ls=\", false, function () {\n  return [useInput];\n});\n\n_c2 = NewPost;\nexport default NewPost;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"NewPostWrapper\");\n$RefreshReg$(_c2, \"NewPost\");","map":{"version":3,"sources":["/Users/sayconfirmproductionsltd/Documents/GitHub/mern-projects/frontend/src/components/NewPost.js"],"names":["React","useContext","useState","styled","toast","Modal","useInput","FeedContext","uploadImage","NewPostIcon","axios","Axios","NewPostWrapper","div","props","theme","red","blue","NewPost","feed","setFeed","showModal","setShowModal","caption","preview","setPreview","postImage","setPostImage","CancelToken","source","handleUploadImage","e","target","files","reader","FileReader","onload","result","readAsDataURL","then","res","console","log","data","secure_url","handleSubmitPost","value","error","tags","split","filter","startsWith","cleanedCaption","join","setValue","body","post","cancelToken","token","isLiked","isSaved","isMine","window","scrollTo","success","err","isCancel","message","cancel","display","onChange"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { toast } from \"react-toastify\";\nimport Modal from \"./Modal\";\nimport useInput from \"../hooks/useInput\";\nimport { FeedContext } from \"../context/FeedContext\";\nimport { uploadImage } from \"../utils\";\nimport { NewPostIcon } from \"./Icons\";\nimport axios from 'axios';\nimport Axios from '../utils/axios'\n\nconst NewPostWrapper = styled.div`\n  .newpost-header {\n    display: flex;\n    justify-content: space-between;\n    padding: 0.5rem 1rem;\n  }\n\n  .newpost-header h3:first-child {\n    color: ${(props) => props.theme.red};\n  }\n\n  h3 {\n    cursor: pointer;\n  }\n\n  .newpost-header h3:last-child {\n    color: ${(props) => props.theme.blue};\n  }\n\n  textarea {\n    height: 100%;\n    width: 100%;\n    font-family: \"Fira Sans\", sans-serif;\n    font-size: 1rem;\n    padding: 0.5rem 1rem;\n    border: none;\n    resize: none;\n  }\n\n  .modal-content {\n    width: 700px;\n  }\n\n  @media screen and (max-width: 780px) {\n    .modal-content {\n      width: 90vw;\n    }\n  }\n`;\n\nconst NewPost = () => {\n  const { feed, setFeed } = useContext(FeedContext);\n  const [showModal, setShowModal] = useState(false);\n  const caption = useInput(\"\");\n  const [preview, setPreview] = useState(\"\");\n  const [postImage, setPostImage] = useState(\"\");\n\n  const CancelToken = axios.CancelToken;\n  const source = CancelToken.source();\n  \n  const handleUploadImage = (e) => {\n    if (e.target.files[0]) {\n      const reader = new FileReader();\n\n      reader.onload = (e) => {\n        setPreview(e.target.result);\n        setShowModal(true);\n      };\n      reader.readAsDataURL(e.target.files[0]);\n\n      uploadImage(e.target.files[0]).then((res) => {\n        console.log('cloudinary',res)\n        setPostImage(res.data.secure_url);\n      });\n    }\n  };\n\n  const handleSubmitPost = async () => {\n    if (!caption.value) {\n      return toast.error(\"Please write a caption\");\n    }\n\n    setShowModal(false);\n\n    const tags = caption.value\n      .split(\" \")\n      .filter((caption) => caption.startsWith(\"#\"));\n\n    const cleanedCaption = caption.value\n      .split(\" \")\n      .filter((caption) => !caption.startsWith(\"#\"))\n      .join(\" \");\n\n    caption.setValue(\"\");\n\n    const body = {\n      caption: cleanedCaption,\n      files: [postImage],\n      tags,\n    };\n\n    try {\n      const res = await Axios.post('/posts', body, {\n        cancelToken: source.token\n      })\n      console.log(res)\n      const post = res.data.data;\n      post.isLiked = false;\n      post.isSaved = false;\n      post.isMine = true;\n      setFeed([post, ...feed]);\n      window.scrollTo(0, 0);\n      toast.success(\"Your post has been submitted successfully\");\n    \n    } catch (err) {\n      if (axios.isCancel(err)) {\n        console.log('Get request canceled');\n        toast.error(err.message)\n      } else {\n        console.log(err)\n        toast.error(err.message)\n      }\n    }\n    return () => {\n      source.cancel('Operation canceled by the user.');\n    };\n  };\n\n  return (\n    <NewPostWrapper>\n      <label htmlFor=\"upload-post\">\n        <NewPostIcon />\n      </label>\n      <input\n        id=\"upload-post\"\n        type=\"file\"\n        onChange={handleUploadImage}\n        accept=\"image/*\"\n        style={{ display: \"none\" }}\n      />\n      {showModal && (\n        <Modal>\n          <div className=\"modal-content\">\n            <div className=\"newpost-header\">\n              <h3 onClick={() => setShowModal(false)}>Cancel</h3>\n              <h3 onClick={handleSubmitPost}>Share</h3>\n            </div>\n            {preview && (\n              <img className=\"post-preview\" src={preview} alt=\"preview\" />\n            )}\n            <div>\n              <textarea\n                placeholder=\"Add caption\"\n                value={caption.value}\n                onChange={caption.onChange}\n              />\n            </div>\n          </div>\n        </Modal>\n      )}\n    </NewPostWrapper>\n  );\n};\n\nexport default NewPost;\n"]},"metadata":{},"sourceType":"module"}